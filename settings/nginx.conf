user  root;
#worker_processes为nginx的进程数，进程数等于CPU的核数（非高并发项目1个进程足矣）
worker_processes  1;
#nginx 进程打开的最多文件描述符数目，一般为ulimit -n与nginx 进程数相除
worker_rlimit_nofile  65535;

#error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    server_tokens  off;
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"'

    # nginx的日志文件，请修改日志的文件名称(不要修改文件路径)
    access_log  /var/log/nginx/ec-access.log  main;
    error_log   /var/log/nginx/ec-error.log warn;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    gzip  on;

    client_max_body_size 1024M;
    client_body_buffer_size 128k;

    #防止504 gateway time out
    fastcgi_connect_timeout 1200s;
    fastcgi_send_timeout 1200s;
    fastcgi_read_timeout 1200s;

    server {
        listen   80 default_server;

        location / {
            root   /usr/share/nginx/html;
            #根据自己项目的特点，设置html、js、css、img等静态资源的缓存时长
            add_header  Cache-Control max-age=86400;
			add_header  X-Frame-Options ALLOWALL;
        }

		location /node_resource {
                alias  /app/tmp/node_resource/;
                add_header Content-Disposition "attachment;filename*=utf-8'zh_cn'$arg_n";
                add_header  Cache-Control no-store;
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Credentials' 'true';
        }

        location ^~ /service {
            proxy_pass http://business_gateway:20000/;

            proxy_redirect  off;
            proxy_cookie_path   / /service/;

            proxy_set_header    Host $host;
            proxy_set_header    X-Real-IP $remote_addr;
            proxy_set_header    X-Forwarded-Host $remote_addr;
            proxy_set_header    X-Forwarded-Server $remote_addr;
            proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;

            # 超时控制
            proxy_connect_timeout 1200s;
            proxy_send_timeout 1200s;
            proxy_read_timeout 1200s;
        }

		location /home/module/denounceFiles/ {
                alias   /home/module/denounceFiles/;
                add_header Content-Disposition "attachment;filename*=utf-8'zh_cn'$arg_n";
                add_header  Cache-Control no-store;
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Credentials' 'true';
        }

		location /images/ {
			alias  	/home/ftpuser/task/result/images/;
			index  index.html index.htm;
	#        add_header X-Frame-Options SAMEORIGIN;
			add_header 'Access-Control-Allow-Origin' '*';
			add_header 'Access-Control-Allow-Credentials' 'true';
		}

		location /home/module/technical {
                alias   /home/module/technical/;
                add_header Content-Disposition "attachment;filename*=utf-8'zh_cn'$arg_n";
                add_header  Cache-Control no-store;
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Credentials' 'true';
        }

		location /home/ftpuser/xk/test/backup {
			proxy_pass http://192.168.200.165:8091/home/ftpuser/xk/test/backup/; #配置的网关地址
			proxy_redirect      default;

			proxy_set_header    X-Real-IP $remote_addr;
			proxy_set_header    X-Forwarded-Host $remote_addr;
			proxy_set_header    X-Forwarded-Server $remote_addr;
			proxy_set_header    X-Forwarded-For  $remote_addr;
			proxy_cookie_path  / /;
			add_header Content-Disposition "attachment;filename*=utf-8'zh_cn'$arg_n";
			add_header  Cache-Control no-store;
			add_header 'Access-Control-Allow-Origin' '*';
			add_header 'Access-Control-Allow-Credentials' 'true';
		}

		location /home/module/network_fraud_warning_new/server/network-fraud-warning-0.0.1-SNAPSHOT/apk {
			proxy_pass http://192.168.200.165:8091/home/module/network_fraud_warning_new/server/network-fraud-warning-0.0.1-SNAPSHOT/apk/; #配置的网关地址
			proxy_redirect      default;

			proxy_set_header    X-Real-IP $remote_addr;
			proxy_set_header    X-Forwarded-Host $remote_addr;
			proxy_set_header    X-Forwarded-Server $remote_addr;
			proxy_set_header    X-Forwarded-For  $remote_addr;
			proxy_cookie_path  / /;
			add_header Content-Disposition "attachment;filename*=utf-8'zh_cn'$arg_n";
			add_header  Cache-Control no-store;
			add_header 'Access-Control-Allow-Origin' '*';
			add_header 'Access-Control-Allow-Credentials' 'true';
		}

    }
}